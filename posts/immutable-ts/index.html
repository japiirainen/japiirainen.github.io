<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/x-icon" href="/favicon.ico"><title>Immutable data structures in typescript</title><meta name="title" content="Immutable data structures in typescript"><meta name="description" content="Immutable data structures are essential when you try to code in a functional way, and JavaScript by itself doesn't support these."><meta property="og:type" content="website"><meta property="og:url"><meta property="og:title" content="Immutable data structures in typescript"><meta property="og:description" content="Immutable data structures are essential when you try to code in a functional way, and JavaScript by itself doesn't support these."><meta property="og:image" content="https://astro.build/social.jpg?v=1"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url"><meta property="twitter:title" content="Immutable data structures in typescript"><meta property="twitter:description" content="Immutable data structures are essential when you try to code in a functional way, and JavaScript by itself doesn't support these."><meta property="twitter:image" content="https://astro.build/social.jpg?v=1"><link rel="preconnect" href="https://fonts.gstatic.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&amp;family=IBM+Plex+Sans:wght@400;700&amp;display=swap"><link rel="stylesheet" href="/blog.css"><link rel="stylesheet" href="/_astro/common-m6xjp.css" type="text/css"></head><body><header class="layout astro-mYHAcGzO"><article class="astro-mYHAcGzO"><h1 class="astro-mYHAcGzO"><a href="/" class="astro-mYHAcGzO"><span class="astro-mYHAcGzO">Home</span></a></h1></article></header><div class="layout astro-eZ0V7RoP"><article class="content astro-eZ0V7RoP"><div class="astro-eZ0V7RoP"><header class="astro-eZ0V7RoP"><img width="720" height="420" class="hero-image astro-eZ0V7RoP" loading="lazy" src="https://images.unsplash.com/photo-1611004739509-f23bd5730705?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=1470&amp;q=80" alt="Immutable-ts"><p class="publish-date astro-eZ0V7RoP">Tuesday, Jan 28 2021</p><h1 class="title astro-eZ0V7RoP">Immutable data structures in typescript</h1><div class="author astro-vgbcRyj4"><p class="astro-vgbcRyj4"><a href="https://github.com/japiirainen" class="astro-vgbcRyj4">@japiirainen</a></p></div></header><main class="astro-eZ0V7RoP"><h1 id="why-would-you-want-immutable-data-structures">Why would you want immutable data structures?</h1><p>Immutable data structures are essential when you try to code in a functional way, and JavaScript by itself doesn’t support these. Luckily we can leverage the type system provided by TypeScript to enforce these immutability rules on our frequently used data structures like arrays and objects.
I only recently found out about this feature and thought that other people might have also missed out so making this short blog post to hopefully provide useful information for at least a couple of you guys!</p><h2 id="arrays">Arrays</h2><p><strong><em>Regular way to initialize an array filled with some integers.</em></strong></p><pre class=" language-ts"><code class="language-ts"><span class="token keyword">const</span> xs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
</code></pre><p>The problem with this is that even though we are using <strong><em>const</em></strong> to prevent reassignments we are allowed to mutate the array as we please.</p><pre class=" language-ts"><code class="language-ts">xs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
</code></pre><p>We can luckily fix this by just giving xs the type <strong><em>ReadOnlyArray</em></strong>.</p><pre class=" language-ts"><code class="language-ts"><span class="token keyword">const</span> xs<span class="token operator">:</span> ReadOnlyArray<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
</code></pre><p>Now we are not allowed to mutate the array!</p><pre class=" language-ts"><code class="language-ts">xs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xs<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> error <span class="token constant">TS2542</span><span class="token operator">:</span> Index signature <span class="token keyword">in</span> <span class="token keyword">type</span> <span class="token string">'readonly number[]'</span> only permits reading<span class="token punctuation">.</span>
</code></pre><p>This is quite awesome. Enforcing immutable data structures makes our code both easier to understand and to maintain. If you are freaked out by this and thinking that what can you even do with these data structures that cannot be changed, stop worrying!. We can still use all the functional techniques that won’t modify the values in place, but return new values instead.</p><p><strong><em>examples</em></strong></p><pre class=" language-ts"><code class="language-ts"><span class="token keyword">const</span> biggerXs <span class="token operator">=</span> xs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> largestInXs <span class="token operator">=</span> xs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">&gt;</span> acc <span class="token operator">?</span> x <span class="token operator">:</span> acc<span class="token punctuation">)</span>
<span class="token keyword">const</span> evenOnly <span class="token operator">=</span> xs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x <span class="token operator">%</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><h2 id="objects">Objects</h2><p>We can do similar things with objects.</p><p><strong><em>Regular way to initialize a user object.</em></strong></p><pre class=" language-ts"><code class="language-ts"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstname<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span>
    lastname<span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">69</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>I didn’t define a type or an interface because in these kinds of situations the compiler can infer the types for free. If you want to make this immutable you actually have to define an interface for the type.</p><p><strong>Immutable way to initialize a user object._</strong></p><pre class=" language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Iuser</span> <span class="token punctuation">{</span>
    <span class="token keyword">readonly</span> firstname<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token keyword">readonly</span> lastname<span class="token operator">:</span> <span class="token builtin">string</span>
    <span class="token keyword">readonly</span> age<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> user<span class="token operator">:</span> Iuser <span class="token operator">=</span> <span class="token punctuation">{</span>
    firstname<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span>
    lastname<span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">69</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>Not if we try to modify a field on our user we get a similar compiler error as before with arrays.</p><pre class=" language-ts"><code class="language-ts">user<span class="token punctuation">.</span>firstname <span class="token operator">=</span> <span class="token string">'bar'</span> <span class="token operator">-</span><span class="token operator">&gt;</span> error <span class="token constant">TS2540</span><span class="token operator">:</span> Cannot assign to <span class="token string">'email'</span> because it <span class="token keyword">is</span> a read<span class="token operator">-</span>only property<span class="token punctuation">.</span>
</code></pre><p>Now if we want to update the user we need some functional techniques again…</p><pre class=" language-ts"><code class="language-ts"><span class="token keyword">const</span> incUserAge <span class="token operator">=</span> <span class="token punctuation">(</span>user<span class="token operator">:</span> Iuser<span class="token punctuation">)</span><span class="token operator">:</span> Iuser <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>user<span class="token punctuation">,</span> age<span class="token operator">:</span> user<span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> birthdayBoy <span class="token operator">=</span> <span class="token function">incUserAge</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> firstname<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> lastname<span class="token operator">:</span> <span class="token string">'var'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">70</span> <span class="token punctuation">}</span>
</code></pre><p>That’s all I wanted to share in this blog post. Hope you found it useful. I will post more stuff related to FP in the future so consider giving me a follow if that sounds interesting ;-).</p></main></div></article></div></body></html>