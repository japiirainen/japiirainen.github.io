<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>My Blog - Immutable data structures in typescript</title>
    <link rel="stylesheet" type="text/css" href="../css/composeconference.css" />
  </head>
  <body>
    <header>
      <div class="heading">
        <div class="logo">
          <div style="float: left"></div>
          <div>
            <a href="../">japiirainen</a>
          </div>
        </div>
        <nav><a href="../">home</a> <a href="../about.html">about</a></nav>
      </div>
    </header>

    <main class="markdown-body" role="main">
      <h1>Immutable data structures in typescript</h1>
      <div class="info">
  <em>Posted on January 28, 2021  by Joona </em><br /><br />
</div>

<h1 id="why-would-you-want-immutable-data-structures">Why would you want immutable data structures?</h1>
<p>Immutable data structures are essential when you try to code in a functional way, and JavaScript by itself doesn’t support these. Luckily we can leverage the type system provided by TypeScript to enforce these immutability rules on our frequently used data structures like arrays and objects. I only recently found out about this feature and thought that other people might have also missed out so making this short blog post to hopefully provide useful information for at least a couple of you guys!</p>
<h2 id="arrays">Arrays</h2>
<p><strong><em>Regular way to initialize an array filled with some integers.</em></strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> xs <span class="op">=</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span>]</span></code></pre></div>
<p>The problem with this is that even though we are using <strong><em>const</em></strong> to prevent reassignments we are allowed to mutate the array as we please.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>xs[<span class="dv">1</span>] <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(xs) <span class="op">-&gt;</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span>]</span></code></pre></div>
<p>We can luckily fix this by just giving xs the type <strong><em>ReadOnlyArray</em></strong>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> xs<span class="op">:</span> ReadOnlyArray<span class="op">&lt;</span><span class="dt">number</span><span class="op">&gt;</span> <span class="op">=</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span>]</span></code></pre></div>
<p>Now we are not allowed to mutate the array!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>xs[<span class="dv">1</span>] <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(xs) <span class="op">-&gt;</span> error TS2542<span class="op">:</span> <span class="bu">Index</span> signature <span class="kw">in</span> <span class="kw">type</span> <span class="st">'readonly number[]'</span> only permits reading<span class="op">.</span></span></code></pre></div>
<p>This is quite awesome. Enforcing immutable data structures makes our code both easier to understand and to maintain. If you are freaked out by this and thinking that what can you even do with these data structures that cannot be changed, stop worrying!. We can still use all the functional techniques that won’t modify the values in place, but return new values instead.</p>
<p><strong><em>examples</em></strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> biggerXs <span class="op">=</span> xs<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> x <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> largestInXs <span class="op">=</span> xs<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> x) <span class="kw">=&gt;</span> x <span class="op">&gt;</span> acc <span class="op">?</span> x <span class="op">:</span> acc)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> evenOnly <span class="op">=</span> xs<span class="op">.</span><span class="fu">filter</span>(x <span class="kw">=&gt;</span> x <span class="op">%</span> <span class="op">==</span> <span class="dv">0</span>)</span></code></pre></div>
<h2 id="objects">Objects</h2>
<p>We can do similar things with objects.</p>
<p><strong><em>Regular way to initialize a user object.</em></strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> user <span class="op">=</span> {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    firstname<span class="op">:</span> <span class="st">'foo'</span><span class="op">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    lastname<span class="op">:</span> <span class="st">'bar'</span><span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    age<span class="op">:</span> <span class="dv">69</span><span class="op">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>I didn’t define a type or an interface because in these kinds of situations the compiler can infer the types for free. If you want to make this immutable you actually have to define an interface for the type.</p>
<p><strong>Immutable way to initialize a user object._</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Iuser {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">readonly</span> firstname<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">readonly</span> lastname<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">readonly</span> age<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> user<span class="op">:</span> Iuser <span class="op">=</span> {</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    firstname<span class="op">:</span> <span class="st">'foo'</span><span class="op">,</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    lastname<span class="op">:</span> <span class="st">'bar'</span><span class="op">,</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    age<span class="op">:</span> <span class="dv">69</span><span class="op">,</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Not if we try to modify a field on our user we get a similar compiler error as before with arrays.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>user<span class="op">.</span><span class="at">firstname</span> <span class="op">=</span> <span class="st">'bar'</span> <span class="op">-&gt;</span> error TS2540<span class="op">:</span> Cannot assign to <span class="st">'email'</span> because it <span class="kw">is</span> a read<span class="op">-</span>only property<span class="op">.</span></span></code></pre></div>
<p>Now if we want to update the user we need some functional techniques again…</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> incUserAge <span class="op">=</span> (user<span class="op">:</span> Iuser)<span class="op">:</span> Iuser <span class="kw">=&gt;</span> ({ <span class="op">...</span>user<span class="op">,</span> age<span class="op">:</span> user<span class="op">.</span><span class="at">age</span> <span class="op">+</span> <span class="dv">1</span> })</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> birthdayBoy <span class="op">=</span> <span class="fu">incUserAge</span>(user) <span class="op">-&gt;</span> { firstname<span class="op">:</span> <span class="st">'foo'</span><span class="op">,</span> lastname<span class="op">:</span> <span class="st">'var'</span><span class="op">,</span> age<span class="op">:</span> <span class="dv">70</span> }</span></code></pre></div>
<p>That’s all I wanted to share in this blog post. Hope you found it useful. I will post more stuff related to FP in the future so consider giving me a follow if that sounds interesting ;-).</p>

    </main>

    <footer>
      Site proudly generated by
      <a href="http://jaspervdj.be/hakyll">Hakyll</a> | Source code is available
      at
      <a href="https://github.com/japiirainen/japiirainen.github.io">GitHub</a>
    </footer>
  </body>
</html>
